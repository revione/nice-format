.api-key-input { flex-direction: column; align-items: stretch; } .api-key-input input { min-width: auto; }<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resaltador de Palabras con Google Translate</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(45deg, #2c3e50, #34495e);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .input-section {
        padding: 30px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
      }

      .input-group label {
        font-weight: bold;
        font-size: 1.2em;
        margin-bottom: 15px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .input-group label::before {
        content: "üìù";
        font-size: 1.3em;
      }

      .language-controls {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
        align-items: center;
      }

      .language-controls select {
        padding: 8px 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        background: white;
      }

      .language-controls button {
        background: #3498db;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s;
      }

      .language-controls button:hover {
        background: #2980b9;
      }

      .language-controls button:disabled {
        background: #95a5a6;
        cursor: not-allowed;
      }

      textarea {
        width: 100%;
        height: 300px;
        padding: 20px;
        border: 3px solid #e0e0e0;
        border-radius: 15px;
        font-size: 16px;
        font-family: Georgia, serif;
        resize: vertical;
        transition: all 0.3s ease;
        background: #fafafa;
      }

      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        background: white;
      }

      .processing-indicator {
        text-align: center;
        padding: 10px;
        color: #667eea;
        font-style: italic;
        display: none;
      }

      .output-section {
        padding: 30px;
        border-top: 3px solid #eee;
        background: #f8f9fa;
      }

      .output-section h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.8em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .output-section h2::before {
        content: "‚ú®";
        font-size: 1.2em;
      }

      #textOutput {
        background: white;
        padding: 30px;
        border-radius: 15px;
        line-height: 1.8;
        font-size: 18px;
        min-height: 200px;
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
        border: 2px solid #e9ecef;
      }

      .highlighted-word {
        color: #2c3e50;
        cursor: pointer;
        position: relative;
        font-weight: 500;
        transition: all 0.3s ease;
        border-bottom: 2px solid #3498db;
        text-decoration: none;
      }

      .highlighted-word:hover {
        color: #e74c3c;
        border-bottom-color: #e74c3c;
        border-bottom-width: 3px;
      }

      .tooltip {
        position: absolute;
        background: #2c3e50;
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        min-width: 180px;
        max-width: 320px;
        opacity: 0;
        transform: translateY(5px);
        transition: all 0.2s ease;
        pointer-events: none;
        font-size: 14px;
      }

      .tooltip.show {
        opacity: 1;
        transform: translateY(0);
      }

      .tooltip::before {
        content: "";
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-bottom: 5px solid #2c3e50;
      }

      .tooltip-word {
        font-size: 1.1em;
        font-weight: bold;
        margin-bottom: 6px;
        color: #3498db;
      }

      .tooltip-meaning {
        font-size: 0.95em;
        margin-bottom: 6px;
        color: #ecf0f1;
        line-height: 1.3;
      }

      .tooltip-type {
        font-size: 0.85em;
        color: #f39c12;
        font-style: italic;
        padding: 2px 6px;
        background: rgba(243, 156, 18, 0.2);
        border-radius: 4px;
        display: inline-block;
      }

      .empty-state {
        text-align: center;
        color: #7f8c8d;
        font-style: italic;
        font-size: 1.2em;
        padding: 60px 20px;
      }

      .empty-state::before {
        content: "üí≠";
        font-size: 3em;
        display: block;
        margin-bottom: 20px;
      }

      .stats {
        margin-top: 20px;
        padding: 15px;
        background: linear-gradient(45deg, #3498db, #2980b9);
        color: white;
        border-radius: 10px;
        font-size: 14px;
        text-align: center;
      }

      .word-cache {
        margin-top: 15px;
        padding: 15px;
        background: #e8f5e8;
        border-radius: 10px;
        border: 1px solid #c3e6cb;
        font-size: 14px;
      }

      .word-cache h4 {
        margin-bottom: 10px;
        color: #155724;
      }

      .cached-words {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .cached-word {
        background: #28a745;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        cursor: pointer;
      }

      .cached-word:hover {
        background: #218838;
      }

      @media (max-width: 768px) {
        .input-section {
          grid-template-columns: 1fr;
          padding: 20px;
          gap: 20px;
        }

        .container {
          margin: 0 10px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 2em;
        }

        textarea {
          height: 200px;
          font-size: 14px;
        }

        .tooltip {
          min-width: 250px;
          max-width: 90vw;
        }

        .api-key-input {
          flex-direction: column;
          align-items: stretch;
        }

        .api-key-input input {
          min-width: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Resaltador de Palabras con Google Translate</h1>
        <p>Traduce autom√°ticamente palabras seleccionadas usando Google Translate API</p>
      </div>

      <div class="input-section">
        <div class="input-group">
          <label for="textInput">Texto a analizar:</label>
          <div class="language-controls">
            <select id="sourceLanguage">
              <option value="auto">Detectar autom√°ticamente</option>
              <option value="de">Alem√°n</option>
              <option value="en">Ingl√©s</option>
              <option value="fr">Franc√©s</option>
              <option value="it">Italiano</option>
              <option value="pt">Portugu√©s</option>
            </select>
            <span>‚Üí</span>
            <select id="targetLanguage">
              <option value="es">Espa√±ol</option>
              <option value="en">Ingl√©s</option>
              <option value="de">Alem√°n</option>
              <option value="fr">Franc√©s</option>
            </select>
            <button id="processBtn" onclick="processTextWithGoogle()">üîç Analizar</button>
          </div>
          <textarea id="textInput" placeholder="Escribe o pega aqu√≠ el texto que quieres analizar..."></textarea>
          <div id="processingIndicator" class="processing-indicator">Procesando palabras con Google Translate... ‚è≥</div>
        </div>

        <div class="input-group">
          <label>Palabras encontradas y traducidas:</label>
          <div id="wordCache" class="word-cache" style="display: none">
            <h4>üìö Diccionario generado:</h4>
            <div id="cachedWords" class="cached-words"></div>
          </div>
          <textarea id="jsonOutput" readonly placeholder="Las traducciones aparecer√°n aqu√≠ autom√°ticamente..."></textarea>
        </div>
      </div>

      <div class="output-section">
        <h2>Texto procesado</h2>
        <div id="textOutput">
          <div class="empty-state">Ingresa tu API key en el c√≥digo y analiza un texto para comenzar</div>
        </div>
        <div id="stats" class="stats" style="display: none"></div>
      </div>
    </div>

    <div id="tooltip" class="tooltip"></div>

    <script>
      let apiKey = "TU_API_KEY_AQUI"; // Reemplaza con tu API key
      let wordDictionary = new Map();
      let currentTooltipWord = null;
      let isProcessing = false;

      // Configuraci√≥n inicial
      const textInput = document.getElementById("textInput");
      const jsonOutput = document.getElementById("jsonOutput");
      const textOutput = document.getElementById("textOutput");
      const tooltip = document.getElementById("tooltip");
      const processBtn = document.getElementById("processBtn");
      const processingIndicator = document.getElementById("processingIndicator");
      const stats = document.getElementById("stats");

      // Texto de ejemplo para demostraci√≥n
      const exampleText =
        "Die Angeh√∂rigen haben die Beleidigung befunden und sind emp√∂rt √ºber den beschimpfender Umfug. Im Bereich des gesch√ºtzter Bereich besonders vertraulicher Kommunikation ist es wichtig, die Totenruhe zu respektieren.";

      // Cargar ejemplo inicial
      setTimeout(() => {
        textInput.value = exampleText;
        // Habilitar el bot√≥n si hay API key
        if (apiKey && apiKey !== "TU_API_KEY_AQUI") {
          processBtn.disabled = false;
        }
      }, 500);

      async function processTextWithGoogle() {
        if (!apiKey || apiKey === "TU_API_KEY_AQUI") {
          alert("Por favor configura tu API key en el c√≥digo");
          return;
        }

        if (isProcessing) return;

        const text = textInput.value.trim();
        if (!text) {
          alert("Por favor ingresa un texto para analizar");
          return;
        }

        isProcessing = true;
        processBtn.disabled = true;
        processingIndicator.style.display = "block";

        try {
          // Extraer palabras √∫nicas (evitar palabras muy cortas o n√∫meros)
          const words = [...new Set(text.match(/\b[a-zA-Z√§√∂√º√Ñ√ñ√ú√ü√±√°√©√≠√≥√∫]+\b/g) || [])].filter((word) => word.length > 2);

          console.log(`Procesando ${words.length} palabras √∫nicas...`);

          const sourceLanguage = document.getElementById("sourceLanguage").value;
          const targetLanguage = document.getElementById("targetLanguage").value;

          // Procesar palabras en lotes peque√±os para evitar l√≠mites de API
          const batchSize = 5; // Reducido para mejor control
          const newDictionary = [];

          for (let i = 0; i < words.length; i += batchSize) {
            const batch = words.slice(i, i + batchSize);
            const translations = await translateBatch(batch, sourceLanguage, targetLanguage);

            translations.forEach((result, index) => {
              const word = batch[index];
              if (result && result.translation && result.translation !== word.toLowerCase()) {
                const entry = {
                  word: word,
                  meaning: result.translation,
                  type: "traducci√≥n autom√°tica",
                };

                newDictionary.push(entry);
                wordDictionary.set(word.toLowerCase(), entry);
              }
            });

            // Pausa entre lotes
            await new Promise((resolve) => setTimeout(resolve, 300));
          }

          // Actualizar la UI
          jsonOutput.value = JSON.stringify(newDictionary, null, 2);
          updateWordCache();
          renderHighlightedText();

          console.log(`‚úÖ Procesadas ${newDictionary.length} palabras exitosamente`);
        } catch (error) {
          console.error("Error procesando texto:", error);
          alert(`Error: ${error.message}`);
        } finally {
          isProcessing = false;
          processBtn.disabled = false;
          processingIndicator.style.display = "none";
        }
      }

      async function translateBatch(words, sourceLanguage, targetLanguage) {
        const translations = [];

        for (const word of words) {
          try {
            const result = await translateSingleWord(word, sourceLanguage, targetLanguage);
            translations.push(result);
          } catch (error) {
            console.error(`Error traduciendo "${word}":`, error);
            translations.push(null);
          }
        }

        return translations;
      }

      async function translateSingleWord(word, sourceLanguage, targetLanguage) {
        const response = await fetch(`https://translation.googleapis.com/language/translate/v2?key=${apiKey}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            q: word,
            target: targetLanguage,
            source: sourceLanguage === "auto" ? undefined : sourceLanguage,
            format: "text",
          }),
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log(`Traducci√≥n de "${word}":`, data); // Para debug

        // Trabajar con la estructura real que devuelve la API
        if (data.data && data.data.translations && data.data.translations.length > 0) {
          const translation = data.data.translations[0];
          return {
            word: word,
            translation: translation.translatedText,
            detectedLanguage: translation.detectedSourceLanguage,
          };
        }

        return null;
      }

      function updateWordCache() {
        const wordCacheElement = document.getElementById("wordCache");
        const cachedWordsElement = document.getElementById("cachedWords");

        if (!wordCacheElement || !cachedWordsElement) {
          console.warn("Elementos de cache no encontrados");
          return;
        }

        if (wordDictionary.size > 0) {
          wordCacheElement.style.display = "block";
          cachedWordsElement.innerHTML = "";

          wordDictionary.forEach((entry, word) => {
            const span = document.createElement("span");
            span.className = "cached-word";
            span.textContent = `${entry.word}: ${entry.meaning}`;
            span.title = `Tipo: ${entry.type}`;
            cachedWordsElement.appendChild(span);
          });
        } else {
          wordCacheElement.style.display = "none";
        }
      }

      function renderHighlightedText() {
        const text = textInput.value;
        if (!text.trim()) {
          textOutput.innerHTML = '<div class="empty-state">Ingresa tu API key en el c√≥digo y analiza un texto para comenzar</div>';
          stats.style.display = "none";
          return;
        }

        if (wordDictionary.size === 0) {
          textOutput.innerHTML = `<div style="color: #34495e; line-height: 1.8;">${escapeHtml(text)}</div>`;
          stats.style.display = "none";
          return;
        }

        let processedText = escapeHtml(text);
        let foundWords = new Set();

        // Ordenar palabras por longitud (m√°s largas primero)
        const sortedWords = Array.from(wordDictionary.keys()).sort((a, b) => b.length - a.length);

        sortedWords.forEach((word) => {
          const entry = wordDictionary.get(word);
          const regex = new RegExp(`\\b${escapeRegExp(entry.word)}\\b`, "gi");

          processedText = processedText.replace(regex, (match) => {
            foundWords.add(word);
            return `<span class="highlighted-word" 
                                  data-word="${escapeHtml(entry.word)}" 
                                  data-meaning="${escapeHtml(entry.meaning)}" 
                                  data-type="${escapeHtml(entry.type)}">${match}</span>`;
          });
        });

        textOutput.innerHTML = processedText;

        // Mostrar estad√≠sticas
        if (foundWords.size > 0) {
          stats.innerHTML = `üìä Se encontraron <strong>${foundWords.size}</strong> palabras traducidas en el texto`;
          stats.style.display = "block";
        } else {
          stats.innerHTML = `üìä No se encontraron palabras traducidas en el texto`;
          stats.style.display = "block";
        }

        // Agregar event listeners para tooltips
        addTooltipListeners();
      }

      function addTooltipListeners() {
        const highlightedWords = document.querySelectorAll(".highlighted-word");

        highlightedWords.forEach((word) => {
          word.addEventListener("mouseenter", showTooltip);
          word.addEventListener("mouseleave", hideTooltip);
        });
      }

      function showTooltip(event) {
        const word = event.target;
        const wordText = word.dataset.word;
        const meaning = word.dataset.meaning;
        const type = word.dataset.type;

        currentTooltipWord = word;

        tooltip.innerHTML = `
                <div class="tooltip-word">${wordText}</div>
                <div class="tooltip-meaning">${meaning}</div>
                <div class="tooltip-type">${type}</div>
            `;

        const rect = word.getBoundingClientRect();
        const tooltipRect = tooltip.getBoundingClientRect();

        let left = rect.left + rect.width / 2 - tooltipRect.width / 2;
        let top = rect.bottom + 15;

        // Ajustar si se sale de la pantalla
        if (left < 10) left = 10;
        if (left + tooltipRect.width > window.innerWidth - 10) {
          left = window.innerWidth - tooltipRect.width - 10;
        }

        if (top + tooltipRect.height > window.innerHeight - 10) {
          top = rect.top - tooltipRect.height - 15;
        }

        tooltip.style.left = left + window.scrollX + "px";
        tooltip.style.top = top + window.scrollY + "px";
        tooltip.classList.add("show");
      }

      function hideTooltip() {
        tooltip.classList.remove("show");
        currentTooltipWord = null;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      }

      // Event listeners adicionales
      window.addEventListener("scroll", () => {
        if (currentTooltipWord) {
          hideTooltip();
        }
      });

      document.addEventListener("click", (e) => {
        if (!e.target.classList.contains("highlighted-word")) {
          hideTooltip();
        }
      });
    </script>
  </body>
</html>
